import{b as c,j as e,I as z,a7 as G,A as V,R as P,a8 as I,w as U,M as q,v as B,t as $,Q}from"./index-Bpu-ZP8V.js";import{M as W,D as K,a as X}from"./index-DOw9Vza5.js";import{C as _}from"./index-CdXBdv_H.js";import{F as J,B as g}from"./index-BwNXfVh5.js";import{c as Y,b as Z}from"./object-B-5gPB25.js";import{B as v}from"./index-B5psXmxu.js";import{S as ee}from"./index-DwaAnJwn.js";import"./PhoneIcon-BpksOs-8.js";const te=48,ne=({option:a,onViewDetail:x})=>{const[f,b]=c.useState(null),m=!!f,p=w=>{b(w.currentTarget)},u=()=>{b(null)};return e.jsxs("div",{children:[e.jsx(z,{"aria-label":"more",id:"long-button","aria-controls":m?"long-menu":void 0,"aria-expanded":m?"true":void 0,"aria-haspopup":"true",onClick:p,children:e.jsx(W,{})}),e.jsxs(G,{id:"long-menu",MenuListProps:{"aria-labelledby":"long-button"},anchorEl:f,open:m,onClose:u,PaperProps:{style:{maxHeight:te*4.5,width:"fit-content"}},children:[e.jsx(V,{onClick:()=>{a.onClick(),u()},children:a==null?void 0:a.actionLabel},a==null?void 0:a.id),e.jsx(V,{onClick:()=>{u(),x()},children:"Xem chi tiết"},a==null?void 0:a.id)]})]})},se=a=>{const{currentOrder:x,onConfirm:f,loading:b=!1}=a,[m,p]=P.useState(x||null),u=Y().shape({id:Z().required("Vui lòng điền mã sản phẩm")}),w=d=>{switch(d){case"pending":return e.jsx("span",{className:"text-md font-bold text-yellow-600",children:"Đang chờ xử lý"});case"received":return e.jsx("span",{className:"text-md font-bold text-blue-600",children:"Đã nhận đơn"});case"processing":return e.jsx("span",{className:"text-md font-bold text-lime-600",children:"Đang xử lý"});case"shipping":return e.jsx("span",{className:"text-md font-bold text-blue-600",children:"Đang giao hàng"});case"delivered":return e.jsx("span",{className:"text-md font-bold text-orange-600",children:"Đã giao hàng"});case"cancelled":return e.jsx("span",{className:"text-md font-bold text-red-600",children:"Đã hủy"})}},C={pending:"Chuyển sang xác nhận",received:"Chuyển sang xử lý",processing:"Chuyển sang giao hàng",shipping:"Chuyển sang đã giao hàng",delivered:"Chuyển sang hoàn thành",completed:"Hoàn thành"},R=async d=>{f({...d})};return c.useEffect(()=>{p(x)},[x]),e.jsx(J,{initialValues:m||{},validationSchema:u,onSubmit:R,enableReinitialize:!0,children:({submitForm:d,values:t,handleSubmit:S,setValues:A,setFieldValue:O})=>{var o,L,y,j,k,F,D,E,T,M;return console.log("values",t),e.jsxs("div",{className:"flex flex-col space-y-20",children:[e.jsxs("div",{className:"flex flex-col space-y-6",children:[e.jsx(g,{type:"text",name:"id",value:t==null?void 0:t.id,disabled:!0,label:"Mã đơn hàng",placeholder:"Nhập mã đơn hàng"}),e.jsxs("div",{className:"flex w-full items-center justify-between",children:[e.jsx("p",{className:"text-md font-bold text-gray-600",children:"Trạng thái đơn hàng"}),(t==null?void 0:t.status)&&w(t==null?void 0:t.status)]}),e.jsxs("div",{className:"flex w-full items-center justify-between",children:[e.jsx("p",{className:"text-md font-bold text-gray-600",children:"Giá trị đơn hàng"}),e.jsxs("p",{className:"text-md font-bold italic text-green-600",children:[(o=Number(t==null?void 0:t.totalAmount))==null?void 0:o.toString().prettyMoney()," "]})]}),e.jsx(I,{}),e.jsxs("div",{className:"grid grid-cols-1 items-center justify-between gap-x-2 gap-y-5 tablet:grid-cols-2",children:[e.jsx(g,{type:"text",name:"createdAt",value:(L=t==null?void 0:t.createdAt)==null?void 0:L.prettyDateTime(),label:"Ngày tạo đơn hàng",placeholder:"Nhập ngày tạo đơn hàng"}),e.jsx(g,{type:"text",name:"updatedAt",value:(y=t==null?void 0:t.updatedAt)==null?void 0:y.prettyDateTime(),label:"Ngày tạo đơn hàng",placeholder:"Nhập ngày tạo đơn hàng"}),e.jsx(g,{type:"text",name:"user.lastName",value:(j=t==null?void 0:t.user)==null?void 0:j.lastName,disabled:!0,label:"Họ khách hàng",placeholder:"Nhập họ khách hàng"}),e.jsx(g,{type:"text",name:"user.firstName",value:(k=t==null?void 0:t.user)==null?void 0:k.firstName,disabled:!0,label:"Tên khách hàng",placeholder:"Nhập tên khách hàng  "})]}),e.jsx(I,{}),e.jsxs("div",{className:"grid grid-cols-1 items-center justify-between gap-x-2 gap-y-5 tablet:grid-cols-2",children:[e.jsx(g,{type:"text",disabled:!0,name:"orderAddress.address",value:(F=t==null?void 0:t.orderAddress)==null?void 0:F.address,label:"Địa chỉ người nhận",placeholder:"Nhập địa chỉ người nhận"}),e.jsx(g,{type:"text",disabled:!0,name:"orderAddress.province",value:(D=t==null?void 0:t.orderAddress)==null?void 0:D.province,label:"Tỉnh thành",placeholder:"Nhập tỉnh thành"}),e.jsx(g,{type:"text",disabled:!0,name:"orderAddress.district",value:(E=t==null?void 0:t.orderAddress)==null?void 0:E.district,label:"Huyện",placeholder:"Nhập huyện"}),e.jsx(g,{type:"text",disabled:!0,name:"orderAddress.ward",value:(T=t==null?void 0:t.orderAddress)==null?void 0:T.ward,label:"Phường xã",placeholder:"Nhập phường, xã"})]}),e.jsx(I,{}),e.jsxs("div",{className:"mt-8 w-full",children:[e.jsx("p",{className:"text-md font-bold text-gray-600",children:"Chi tiết đơn hàng"}),e.jsx("div",{className:"mt-4",children:(M=t==null?void 0:t.orderDetails)==null?void 0:M.map((i,n)=>{var s;return e.jsxs("div",{className:"flex w-1/2 items-center justify-between",children:[e.jsxs("p",{children:["Sản phẩm ",e.jsx("strong",{children:(s=i==null?void 0:i.product)==null?void 0:s.name})]}),e.jsxs("div",{className:"flex gap-x-2",children:[e.jsx("p",{children:i==null?void 0:i.quantity}),e.jsxs("strong",{className:"font-semibold text-green-600",children:["(",(Number(i==null?void 0:i.price)*1e3).toString().prettyMoney(),")"]})]})]})})})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{}),e.jsx("div",{className:"flex items-center",children:e.jsx(v,{type:"submit",title:C==null?void 0:C[t==null?void 0:t.status],variant:"primary",className:"ml-2",isLoading:b,onClick:S})})]})]})}})},ge=()=>{const a=[{id:"pending",label:"Chờ xác nhận"},{id:"received",label:"Đã nhận đơn"},{id:"processing",label:"Đang xử lý"},{id:"shipping",label:"Đang giao hàng"},{id:"delivered",label:"Đã giao hàng"},{id:"completed",label:"Hoàn thành"}],[x,f]=c.useState(!1),[b,m]=c.useState([]),[p,u]=c.useState([]),[w,C]=c.useState([]),[R,d]=c.useState(!1),[t,S]=c.useState(!1),[A,O]=c.useState(null),[o,L]=c.useState(a[0]),y={pending:{label:"Chờ xác nhận",actionLabel:"Chuyển sang xác nhận",status:"received",onclick:()=>{}},received:{label:"Đã nhận đơn",actionLabel:"Chuyển sang xử lý",status:"processing",onclick:()=>{}},processing:{label:"Đang xử lý",actionLabel:"Chuyển sang giao hàng",status:"shipping",onclick:()=>{}},shipping:{label:"Đang giao hàng",actionLabel:"Chuyển sang đã giao hàng",status:"delivered",onclick:()=>{}},delivered:{label:"Đã giao hàng",actionLabel:"Chuyển sang hoàn thành",status:"completed",onclick:()=>{}},completed:{label:"Hoàn thành",actionLabel:""}},{user:j,accessToken:k,isAuthorizedForAdmin:F,isAuthorizedForManager:D}=U(),E=n=>{switch(n){case"pending":return e.jsx("span",{className:"text-sm font-bold text-yellow-600",children:"Đang chờ xử lý"});case"received":return e.jsx("span",{className:"text-sm font-bold text-blue-600",children:"Đã nhận đơn"});case"processing":return e.jsx("span",{className:"text-sm font-bold text-lime-600",children:"Đang xử lý"});case"shipping":return e.jsx("span",{className:"text-sm font-bold text-blue-600",children:"Đang giao hàng"});case"delivered":return e.jsx("span",{className:"text-sm font-bold text-orange-600",children:"Đã giao hàng"});case"cancelled":return e.jsx("span",{className:"text-sm font-bold text-red-600",children:"Đã hủy"})}},T=[{field:"actions",headerName:"Hành động",type:"string",width:100,renderCell:n=>{if(D){const s=y==null?void 0:y[n.row.status];return e.jsx(ne,{onViewDetail:()=>{O(n.row),S(!0)},option:{...s,onClick:()=>i(n.row.id,s==null?void 0:s.status)}})}else return e.jsx(e.Fragment,{})}},{field:"id",headerName:"ID",width:70,renderHeader:()=>e.jsx("div",{className:"font-bold text-gray-800",children:"ID"})},{field:"user",headerName:"Người đặt hàng",width:200,renderCell:n=>{var s,r,l,h;return e.jsxs("div",{className:"font-bold text-gray-600",children:[(r=(s=n==null?void 0:n.row)==null?void 0:s.user)==null?void 0:r.firstName," ",(h=(l=n==null?void 0:n.row)==null?void 0:l.user)==null?void 0:h.lastName," "]})}},{field:"status",headerName:"Trạng thái",type:"string",width:200,headerAlign:"left",align:"left",renderCell:n=>E(n.row.status)},{field:"totalAmount",headerName:"Giá trị đơn hàng",width:200,renderCell:n=>{var s,r,l;return e.jsx("div",{className:"font-bold text-green-600",children:(l=(r=Number((s=n==null?void 0:n.row)==null?void 0:s.totalAmount))==null?void 0:r.toString())==null?void 0:l.prettyMoney()})}},{field:"createdAt",headerName:"Ngày tạo",type:"string",width:200,renderCell:n=>{var s,r,l;return e.jsx("div",{className:"text-gray-600",children:(l=(r=(s=n==null?void 0:n.row)==null?void 0:s.createdAt)==null?void 0:r.toString())==null?void 0:l.prettyDateTime()})}},{field:"updatedAt",headerName:"Ngày cập nhật",type:"string",width:200,renderCell:n=>{var s,r,l;return e.jsx("div",{className:"text-gray-600",children:(l=(r=(s=n==null?void 0:n.row)==null?void 0:s.updatedAt)==null?void 0:r.toString())==null?void 0:l.prettyDateTime()})}}],M=async n=>{var r,l,h;const{addLoadingEffect:s}=n||{};try{s&&d(!0);const H=`${B}/orders/store/${(r=j==null?void 0:j.store)==null?void 0:r.id}`,N=await $.get(`${H}`,{headers:{Authorization:`Bearer ${k}`}});((l=N==null?void 0:N.data)==null?void 0:l.success)==!0&&u((h=N==null?void 0:N.data)==null?void 0:h.data)}catch(H){console.log("GET USER ERROR",H)}finally{s&&d(!1)}},i=async(n,s)=>{var r;try{d(!0);const l={status:s},h=await $.put(`${B}/orders/${n}`,l,{headers:{Authorization:`Bearer ${k}`}});((r=h==null?void 0:h.data)==null?void 0:r.success)==!0?(d(!1),Q.success("Cập nhật đơn hàng thành công"),M({addLoadingEffect:!0})):d(!1)}catch{d(!1),console.log("error")}finally{d(!1)}};return c.useEffect(()=>{M({addLoadingEffect:!0})},[]),c.useEffect(()=>{if(o){const n=p.filter(s=>s.status==(o==null?void 0:o.id));C([...n])}},[o,p]),e.jsxs(e.Fragment,{children:[e.jsx(q,{title:"Quản lý đơn hàng",content:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-8 w-[250px]",children:e.jsx(ee,{optionSelected:o,options:a,keyLabel:"label",keyValue:"id",onSelect:n=>L(n),name:"status",placeholder:"Chọn trạng thái",label:"Trạng thái đơn hàng"})}),e.jsx("div",{className:"flex w-full flex-col gap-y-5 rounded-2xl bg-white",children:e.jsx("div",{className:"h-[700px] w-full",children:e.jsx(K,{components:{NoRowsOverlay:()=>e.jsx("div",{className:"flex h-full w-full items-center justify-center",children:e.jsx("p",{className:"text-sm text-gray-500",children:"Không có dữ liệu"})}),LoadingOverlay:X},sx:{borderRadius:"8px"},rows:w||p,loading:R,paginationMode:"client",pageSize:12,columns:T,disableSelectionOnClick:!0,onSelectionModelChange:n=>{f(!x),m(n)},selectionModel:b,checkboxSelection:!1})})})]})}),t?e.jsx(_,{title:"Chi tiết đơn hàng",open:t,maxWidth:"lg",onClose:()=>{S(!1),O(null)},children:e.jsx(se,{currentOrder:A,onConfirm:n=>{i(A==null?void 0:A.id,n==null?void 0:n.status),S(!1),O(null)}})}):null]})};export{ge as default};
